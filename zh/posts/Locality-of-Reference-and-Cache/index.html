<!doctypehtml><html lang=zh-CN><meta charset=UTF-8><meta content=width=device-width name=viewport><meta content=#222222 name=theme-color><meta content="Hexo 7.3.0" name=generator><link crossorigin href=https://cdnjs.cloudflare.com rel=preconnect><link href=/zh/images/apple-touch-icon-lightbulb.png rel=apple-touch-icon sizes=180x180><link href=/zh/images/favicon-32x32-lightbulb.png rel=icon sizes=32x32 type=image/png><link href=/zh/images/favicon-16x16-lightbulb.png rel=icon sizes=16x16 type=image/png><link color=#222222 href=/zh/images/logo-lightbulb.svg rel=mask-icon><style>:root{--body-bg-color:#f5f7f9;--content-bg-color:#fff;--card-bg-color:#f5f5f5;--text-color:#555;--selection-bg:#262a30;--selection-color:#eee;--blockquote-color:#666;--link-color:#555;--link-hover-color:#222;--brand-color:#fff;--brand-hover-color:#fff;--table-row-odd-bg-color:#f9f9f9;--table-row-hover-bg-color:#f5f5f5;--menu-item-bg-color:#f5f5f5;--theme-color:#222;--btn-default-bg:#fff;--btn-default-color:#555;--btn-default-border-color:#555;--btn-default-hover-bg:#222;--btn-default-hover-color:#fff;--btn-default-hover-border-color:#222;--highlight-background:#fdf6e3;--highlight-foreground:#586e75;--highlight-gutter-background:#ece8d8;--highlight-gutter-foreground:#687b80;color-scheme:light}html{line-height:1.15;-webkit-text-size-adjust:100%}details,main{display:block}pre{font-size:1em;overflow:auto;padding:10px}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}.table-container,textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}summary{display:list-item}[hidden],template{display:none}::selection{background:var(--selection-bg);color:var(--selection-color)}body,html{height:100%}body{margin:0;background:var(--body-bg-color);box-sizing:border-box;color:var(--text-color);font-family:Lato,'PingFang SC','Microsoft YaHei',sans-serif;font-size:1em;line-height:2;min-height:100%;position:relative;transition:padding .2s ease-in-out}h1,h2,h3,h4,h5,h6{font-family:Lato,'PingFang SC','Microsoft YaHei',sans-serif;font-weight:700;line-height:1.5;margin:30px 0 15px}h1{font-size:1.5em}h2{font-size:1.375em}h3{font-size:1.25em}h4{font-size:1.125em}h5{font-size:1em}h6{font-size:.875em}p{margin:0 0 20px}a{background:0 0;border-bottom:1px solid #999;color:var(--link-color);cursor:pointer;outline:0;text-decoration:none;overflow-wrap:break-word}a:hover{border-bottom-color:var(--link-hover-color);color:var(--link-hover-color)}embed,iframe,img,video{display:block;margin-left:auto;margin-right:auto;max-width:100%}hr{box-sizing:content-box;overflow:visible;background-image:repeating-linear-gradient(-45deg,#ddd,#ddd 4px,transparent 4px,transparent 8px);border:0;height:3px;margin:40px 0}blockquote{border-left:4px solid #ddd;color:var(--blockquote-color);margin:0;padding:0 15px}blockquote cite::before{content:'-';padding:0 5px}dt{font-weight:700}dd{margin:0;padding:0}table{border-collapse:collapse;border-spacing:0;font-size:.875em;margin:0 0 20px;width:100%}tbody tr:nth-of-type(odd){background:var(--table-row-odd-bg-color)}tbody tr:hover{background:var(--table-row-hover-bg-color)}caption,td,th{padding:8px}td,th{border:1px solid #ddd;border-bottom:3px solid #ddd}th{font-weight:700;padding-bottom:10px}td{border-bottom-width:1px}.btn{background:var(--btn-default-bg);border:2px solid var(--btn-default-border-color);border-radius:2px;color:var(--btn-default-color);display:inline-block;font-size:.875em;line-height:2;padding:0 20px;transition:background-color .2s ease-in-out}.btn:hover{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.btn+.btn{margin:0 0 8px 8px}.btn .fa-fw{text-align:left;width:1.285714285714286em}.toggle{line-height:0}.toggle .toggle-line{background:#fff;display:block;height:2px;left:0;position:relative;top:0;transition:left .4s,opacity .4s,top .4s,transform .4s,width .4s;width:100%}.toggle .toggle-line:first-child{margin-top:1px}.toggle .toggle-line:not(:first-child){margin-top:4px}.toggle.toggle-arrow :first-child{left:50%;top:2px;transform:rotate(45deg);width:50%}.toggle.toggle-arrow :last-child{left:50%;top:-2px;transform:rotate(-45deg);width:50%}.toggle.toggle-close :nth-child(2){opacity:0}.toggle.toggle-close :first-child{top:6px;transform:rotate(45deg)}.toggle.toggle-close :last-child{top:-6px;transform:rotate(-45deg)}/*!
  Theme: Solarized Light
  Author: Ethan Schoonover (modified by aramisgithub)
  License: ~ MIT (or more permissive) [via base16-schemes-source]
  Maintainer: @highlightjs/core-team
  Version: 2021.09.0
*/pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#586e75;background:#fdf6e3}.hljs ::selection,.hljs::selection{background-color:#93a1a1;color:#586e75}.hljs-comment{color:#839496}.hljs-tag{color:#657b83}.hljs-operator,.hljs-punctuation,.hljs-subst{color:#586e75}.hljs-operator{opacity:.7}.hljs-bullet,.hljs-deletion,.hljs-name,.hljs-selector-tag,.hljs-template-variable,.hljs-variable{color:#dc322f}.hljs-attr,.hljs-link,.hljs-literal,.hljs-number,.hljs-symbol,.hljs-variable.constant_{color:#cb4b16}.hljs-class .hljs-title,.hljs-title,.hljs-title.class_{color:#b58900}.hljs-strong{font-weight:700;color:#b58900}.hljs-addition,.hljs-code,.hljs-string,.hljs-title.class_.inherited__{color:#859900}.hljs-built_in,.hljs-doctag,.hljs-keyword.hljs-atrule,.hljs-quote,.hljs-regexp{color:#2aa198}.hljs-attribute,.hljs-function .hljs-title,.hljs-section,.hljs-title.function_,.ruby .hljs-property{color:#268bd2}.diff .hljs-meta,.hljs-keyword,.hljs-template-tag,.hljs-type{color:#6c71c4}.hljs-emphasis{color:#6c71c4;font-style:italic}.hljs-meta,.hljs-meta .hljs-keyword,.hljs-meta .hljs-string{color:#d33682}.hljs-meta .hljs-keyword,.hljs-meta-keyword{font-weight:700}.code-container:hover .copy-btn,.highlight:hover .copy-btn{opacity:1}.code-container{position:relative}.copy-btn{color:#333;cursor:pointer;line-height:1.6;opacity:0;padding:2px 6px;position:absolute;transition:opacity .2s ease-in-out;background:#fff;border:0;font-size:.8125em;right:0;top:0}code,figure.highlight,kbd,pre{background:var(--highlight-background);color:var(--highlight-foreground)}figure.highlight,pre{line-height:1.6;margin:0 auto 20px}figure.highlight figcaption,pre .caption,pre figcaption{background:var(--highlight-gutter-background);color:var(--highlight-foreground);display:flow-root;font-size:.875em;line-height:1.2;padding:.5em}figure.highlight figcaption a,pre .caption a,pre figcaption a{color:var(--highlight-foreground);float:right}figure.highlight figcaption a:hover,pre .caption a:hover,pre figcaption a:hover{border-bottom-color:var(--highlight-foreground)}code,pre{font-family:consolas,Menlo,monospace,'PingFang SC','Microsoft YaHei'}code{border-radius:3px;font-size:.875em;padding:2px 4px;overflow-wrap:break-word}kbd{border:2px solid #ccc;border-radius:.2em;box-shadow:.1em .1em .2em rgba(0,0,0,.1);font-family:inherit;padding:.1em .3em;white-space:nowrap}figure.highlight{overflow:auto;position:relative}figure.highlight pre{border:0;margin:0;padding:10px 0}figure.highlight table{border:0;margin:0;width:auto}figure.highlight td{border:0;padding:0}figure.highlight .gutter{-moz-user-select:none;-ms-user-select:none;-webkit-user-select:none;user-select:none}figure.highlight .gutter pre{background:var(--highlight-gutter-background);color:var(--highlight-gutter-foreground);padding-left:10px;padding-right:10px;text-align:right}figure.highlight .code pre{padding-left:10px;width:100%}figure.highlight .marked{background:rgba(0,0,0,.3)}pre .caption,pre figcaption{margin-bottom:10px}.gist table{width:auto}.gist table td{border:0}pre code{background:0 0;padding:0;text-shadow:none}.blockquote-center{border-left:0;margin:40px 0;padding:0;position:relative;text-align:center}.blockquote-center::after,.blockquote-center::before{left:0;line-height:1;opacity:.6;position:absolute;width:100%}.blockquote-center::before{border-top:1px solid #ccc;text-align:left;top:-20px;content:'\f10d';font-family:'Font Awesome 6 Free';font-weight:900}.blockquote-center::after{border-bottom:1px solid #ccc;bottom:-20px;text-align:right;content:'\f10e';font-family:'Font Awesome 6 Free';font-weight:900}.blockquote-center div,.blockquote-center p{text-align:center}.group-picture{margin-bottom:20px}.group-picture .group-picture-row{display:flex;gap:3px;margin-bottom:3px}.group-picture .group-picture-column{flex:1}.group-picture .group-picture-column img{height:100%;margin:0;object-fit:cover;width:100%}.post-body .label{color:#555;padding:0 2px}.post-body .label.default{background:#f0f0f0}.post-body .label.primary{background:#efe6f7}.post-body .label.info{background:#e5f2f8}.post-body .label.success{background:#e7f4e9}.post-body .label.warning{background:#fcf6e1}.post-body .label.danger{background:#fae8eb}.post-body .link-grid{display:grid;grid-gap:1.5rem;gap:1.5rem;grid-template-columns:1fr 1fr;margin-bottom:20px;padding:1rem}.post-body .link-grid .link-grid-container{border:solid #ddd;box-shadow:1rem 1rem .5rem rgba(0,0,0,.5);min-height:5rem;min-width:0;padding:.5rem;position:relative;transition:background .3s}.post-body .link-grid .link-grid-container:hover{animation:.5s next-shake;background:var(--card-bg-color)}.post-body .link-grid .link-grid-container:active{box-shadow:.5rem .5rem .25rem rgba(0,0,0,.5);transform:translate(.2rem,.2rem)}.post-body .link-grid .link-grid-container .link-grid-image{border:1px solid #ddd;border-radius:50%;box-sizing:border-box;height:5rem;padding:3px;position:absolute;width:5rem}.post-body .link-grid .link-grid-container p{margin:0 1rem 0 6rem}.post-body .link-grid .link-grid-container p:first-of-type{font-size:1.2em}.post-body .link-grid .link-grid-container p:last-of-type{font-size:.8em;line-height:1.3rem;opacity:.7}.post-body .link-grid .link-grid-container a{border:0;height:100%;left:0;position:absolute;top:0;width:100%}@keyframes next-shake{0%{transform:translate(1pt,1pt) rotate(0)}10%{transform:translate(-1pt,-2pt) rotate(-1deg)}20%{transform:translate(-3pt,0) rotate(1deg)}30%{transform:translate(3pt,2pt) rotate(0)}40%{transform:translate(1pt,-1pt) rotate(1deg)}50%{transform:translate(-1pt,2pt) rotate(-1deg)}60%{transform:translate(-3pt,1pt) rotate(0)}70%{transform:translate(3pt,1pt) rotate(-1deg)}80%{transform:translate(-1pt,-1pt) rotate(1deg)}90%{transform:translate(1pt,2pt) rotate(0)}100%{transform:translate(1pt,-2pt) rotate(-1deg)}}.mermaid,.wavedrom{margin-bottom:20px;text-align:center}.post-body .note{border-radius:3px;margin-bottom:20px;padding:1em;position:relative;background:#f9f9f9;border:initial;border-left:3px solid #eee}.post-body .note summary{cursor:pointer;outline:0}.post-body .note summary p{display:inline}.post-body .note h2,.post-body .note h3,.post-body .note h4,.post-body .note h5,.post-body .note h6{border-bottom:initial;margin:0;padding-top:0}.post-body .note :first-child{margin-top:0}.post-body .note :last-child{margin-bottom:0}.post-body .note:not(.no-icon){padding-left:2.5em}.post-body .note:not(.no-icon)::before{font-size:1.5em;left:.3em;position:absolute;top:calc(50% - 1em)}.post-body .note.default{background:#f7f7f7;border-left-color:#777}.post-body .note.default h2,.post-body .note.default h3,.post-body .note.default h4,.post-body .note.default h5,.post-body .note.default h6{color:#777}.post-body .note.default:not(.no-icon)::before{content:'\f0a9';font-family:'Font Awesome 6 Free';font-weight:900;color:#777}.post-body .note.primary{background:#f5f0fa;border-left-color:#6f42c1}.post-body .note.primary h2,.post-body .note.primary h3,.post-body .note.primary h4,.post-body .note.primary h5,.post-body .note.primary h6{color:#6f42c1}.post-body .note.primary:not(.no-icon)::before{content:'\f055';font-family:'Font Awesome 6 Free';font-weight:900;color:#6f42c1}.post-body .note.info{background:#eef7fa;border-left-color:#428bca}.post-body .note.info h2,.post-body .note.info h3,.post-body .note.info h4,.post-body .note.info h5,.post-body .note.info h6{color:#428bca}.post-body .note.info:not(.no-icon)::before{content:'\f05a';font-family:'Font Awesome 6 Free';font-weight:900;color:#428bca}.post-body .note.success{background:#eff8f0;border-left-color:#5cb85c}.post-body .note.success h2,.post-body .note.success h3,.post-body .note.success h4,.post-body .note.success h5,.post-body .note.success h6{color:#5cb85c}.post-body .note.success:not(.no-icon)::before{content:'\f058';font-family:'Font Awesome 6 Free';font-weight:900;color:#5cb85c}.post-body .note.warning{background:#fdf8ea;border-left-color:#f0ad4e}.post-body .note.warning h2,.post-body .note.warning h3,.post-body .note.warning h4,.post-body .note.warning h5,.post-body .note.warning h6{color:#f0ad4e}.post-body .note.warning:not(.no-icon)::before{content:'\f06a';font-family:'Font Awesome 6 Free';font-weight:900;color:#f0ad4e}.post-body .note.danger{background:#fcf1f2;border-left-color:#d9534f}.post-body .note.danger h2,.post-body .note.danger h3,.post-body .note.danger h4,.post-body .note.danger h5,.post-body .note.danger h6{color:#d9534f}.post-body .note.danger:not(.no-icon)::before{content:'\f056';font-family:'Font Awesome 6 Free';font-weight:900;color:#d9534f}.post-body .tabs{margin-bottom:20px}.post-body .tabs,.tabs-comment{padding-top:10px}.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{background:var(--content-bg-color);display:flex;display:flex;flex-wrap:wrap;justify-content:center;margin:0;padding:0;position:-webkit-sticky;position:sticky;top:0;z-index:5}.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border-bottom:1px solid #ddd;border-left:1px solid transparent;border-right:1px solid transparent;border-radius:0;border-top:3px solid transparent;flex-grow:1;list-style-type:none;transition:.2s ease-out}@media (max-width:413px){.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{display:block;margin-bottom:5px}.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border-bottom:1px solid transparent;border-left:3px solid transparent;border-right:1px solid transparent;border-top:1px solid transparent;border-radius:0}}.post-body .tabs ul.nav-tabs li.tab a,.tabs-comment ul.nav-tabs li.tab a{border-bottom:initial;display:block;line-height:1.8;padding:.25em .75em;text-align:center;transition:.2s ease-out}.post-body .tabs ul.nav-tabs li.tab a i[class^=fa],.tabs-comment ul.nav-tabs li.tab a i[class^=fa]{width:1.285714285714286em}.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#fc6423 #ddd transparent}@media (max-width:413px){.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#ddd #ddd #ddd #fc6423}}.post-body .tabs ul.nav-tabs li.tab.active a,.tabs-comment ul.nav-tabs li.tab.active a{cursor:default}.post-body .tabs .tab-content,.tabs-comment .tab-content{border:1px solid #ddd;border-radius:0;border-top-color:transparent}@media (max-width:413px){.post-body .tabs .tab-content,.tabs-comment .tab-content{border-radius:0;border-top-color:#ddd}}.post-body .tabs .tab-content .tab-pane,.tabs-comment .tab-content .tab-pane{padding:20px 20px 0}.post-body .tabs .tab-content .tab-pane:not(.active),.tabs-comment .tab-content .tab-pane:not(.active){display:none}.pagination .next,.pagination .page-number,.pagination .prev,.pagination .space{display:inline-block;margin:-1px 10px 0;padding:0 10px}.pagination .page-number.current{background:#ccc;border-color:#ccc;color:var(--content-bg-color)}.pagination{border-top:1px solid #eee;margin:120px 0 0;text-align:center}.pagination .next,.pagination .page-number,.pagination .prev{border-bottom:0;border-top:1px solid #eee;transition:border-color .2s ease-in-out}.pagination .next:hover,.pagination .page-number:hover,.pagination .prev:hover{border-top-color:var(--link-hover-color)}@media (max-width:767px){.post-body .link-grid{grid-template-columns:1fr}.pagination .next,.pagination .page-number,.pagination .prev,.pagination .space{margin:0 5px}.pagination{border-top:0}.pagination .next,.pagination .page-number,.pagination .prev{border-bottom:1px solid #eee;border-top:0}.pagination .next:hover,.pagination .page-number:hover,.pagination .prev:hover{border-bottom-color:var(--link-hover-color)}.site-meta{text-align:center}}.pagination .space{margin:0;padding:0}.comments{margin-top:60px;overflow:hidden}.comment-button-group{display:flex;display:flex;flex-wrap:wrap;justify-content:center;justify-content:center;margin:1em 0}.comment-button-group .comment-button{margin:.1em .2em}.comment-button-group .comment-button.active{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.comment-position{display:none}.comment-position.active{display:block}.tabs-comment{margin-top:4em;padding-top:0}.tabs-comment .comments{margin-top:0;padding-top:0}.headband{background:var(--theme-color);height:3px}@media (max-width:991px){.headband{display:none}}.site-brand-container{display:flex;flex-shrink:0;padding:0 10px}.use-motion .column,.use-motion .site-brand-container .toggle{opacity:0}.site-meta{flex-grow:1;text-align:center}.custom-logo-image{margin-top:20px}@media (max-width:991px){.custom-logo-image{display:none}}.brand{border-bottom:0;color:var(--brand-color);display:inline-block;padding:0}.brand:hover{color:var(--brand-hover-color)}.site-title{font-family:Lato,'PingFang SC','Microsoft YaHei',sans-serif;font-size:1.375em;font-weight:400;line-height:1.5;margin:0}.site-subtitle{color:#ddd;font-size:.8125em;margin:10px 10px 0}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:0;position:relative;top:-10px}.site-nav-right,.site-nav-toggle{display:none}.site-nav-right .toggle,.site-nav-toggle .toggle{color:var(--text-color);padding:10px;width:22px}.site-nav-right .toggle .toggle-line,.site-nav-toggle .toggle .toggle-line{background:var(--text-color);border-radius:1px}@media (max-width:767px){.site-nav-right,.site-nav-toggle{display:flex;flex-direction:column;justify-content:center}.site-nav{--scroll-height:0;height:0;overflow:hidden;transition:height .2s ease-in-out,visibility .2s ease-in-out;visibility:hidden}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height);visibility:unset}}.menu{margin:0;padding:1em 0;text-align:center}.menu-item{display:inline-block;list-style:none;margin:0 10px}@media (max-width:767px){.menu-item{display:block;margin-top:10px}.menu-item.menu-item-search{display:none}}.menu-item a{border-bottom:0;display:block;font-size:.8125em;transition:border-color .2s ease-in-out}.menu-item a.menu-item-active,.menu-item a:hover{background:var(--menu-item-bg-color)}.menu-item i[class^=fa]{margin-right:8px}.menu-item .badge{background:#ccc;border-radius:10px;color:var(--content-bg-color);font-weight:700;line-height:1;margin-left:.35em;padding:2px 5px;text-shadow:1px 1px 0 rgba(0,0,0,.1)}.use-motion .menu-item{visibility:hidden}.book-mark-link{border-bottom:0;position:fixed;top:-10px;transition:top .3s;right:30px}.book-mark-link::before{color:#e91e63;font-size:32px;line-height:1;content:'\f02e';font-family:'Font Awesome 6 Free';font-weight:900}.book-mark-link-fixed,.book-mark-link:hover{top:-2px}@media (max-width:991px){.book-mark-link{right:20px;display:none}.sidebar{left:-320px;background:#222;bottom:0;max-height:100vh;overflow-y:auto;position:fixed;top:0;transition:left .2s ease-out,right .2s ease-out;width:320px;z-index:20}.sidebar-active .sidebar{left:0}.sidebar a{border-bottom-color:#555;color:#999}.sidebar a:hover{border-bottom-color:#eee;color:#eee}.links-of-author:not(:first-child){margin-top:15px}.links-of-author a{border-bottom-color:#555;display:inline-block;margin-bottom:10px;margin-right:10px;vertical-align:middle;transition:.2s ease-in-out}.links-of-author a::before{background:#ff679e;display:inline-block;margin-right:3px;transform:translateY(-2px);border-radius:50%;content:' ';height:4px;width:4px}.links-of-blogroll-item{padding:2px 10px}.links-of-blogroll-item a{box-sizing:border-box;display:inline-block;max-width:280px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.popular-posts .popular-posts-item .popular-posts-link:hover{background:0 0}.sidebar-dimmer{background:#000;height:100%;left:0;opacity:0;position:fixed;top:0;transition:visibility .4s,opacity .4s;visibility:hidden;width:100%;z-index:10}.sidebar-active .sidebar-dimmer{opacity:.7;visibility:visible}}.sidebar-inner{color:#999;padding:18px 10px;text-align:center;display:flex;flex-direction:column;justify-content:center}.cc-license .cc-opacity{border-bottom:0;opacity:.7}.cc-license .cc-opacity:hover{opacity:.9}.cc-license img{display:inline-block}.site-author-image{border:1px solid #eee;max-width:120px;padding:2px;border-radius:50%}.site-author-name{color:var(--text-color);font-weight:600;margin:0}.site-description{color:#999;font-size:.8125em;margin-top:0}.links-of-author a{font-size:.8125em}.sidebar .sidebar-button:not(:first-child){margin-top:15px}.sidebar .sidebar-button button{background:0 0;color:#fc6423;cursor:pointer;line-height:2;padding:0 15px;border:1px solid #fc6423;border-radius:4px}.sidebar .sidebar-button button:hover{background:#fc6423;color:#fff}.sidebar .sidebar-button button i[class^=fa]{margin-right:5px}.links-of-blogroll{font-size:.8125em}.links-of-blogroll-title{font-size:.875em;font-weight:600}.links-of-blogroll-list{list-style:none;margin:0;padding:0}.sidebar-nav{font-size:.875em;height:0;margin:0;overflow:hidden;padding-left:0;pointer-events:none;transition:height .2s ease-in-out,visibility .2s ease-in-out;visibility:hidden}.sidebar-nav-active .sidebar-nav{height:calc(2em + 1px);pointer-events:unset;visibility:unset}.sidebar-nav li{border-bottom:1px solid transparent;color:var(--text-color);cursor:pointer;display:inline-block;transition:border-bottom-color .2s ease-in-out,color .2s ease-in-out}.sidebar-nav li.sidebar-nav-overview{margin-left:10px}.sidebar-nav li:hover{color:#fc6423}.sidebar-overview-active .sidebar-nav-overview,.sidebar-toc-active .sidebar-nav-toc{border-bottom-color:#fc6423;color:#fc6423;transition-delay:0.2s}.sidebar-overview-active .sidebar-nav-overview:hover,.sidebar-toc-active .sidebar-nav-toc:hover{color:#fc6423}.sidebar-panel-container{align-items:start;display:grid;flex:1;overflow-x:hidden;overflow-y:auto;padding-top:0;transition:padding-top .2s ease-in-out}.sidebar-nav-active .sidebar-panel-container{padding-top:20px}.sidebar-panel{animation:.2s ease-in-out deactivate-sidebar-panel;grid-area:1/1;height:0;opacity:0;overflow:hidden;pointer-events:none;transform:translateY(0);transition:.2s ease-in-out;transition-property:opacity,transform,visibility;visibility:hidden}.sidebar-nav-active .sidebar-panel,.sidebar-overview-active .sidebar-panel.post-toc-wrap{transform:translateY(-20px)}.sidebar-overview-active:not(.sidebar-nav-active) .sidebar-panel.post-toc-wrap{transition-delay:0s,0.2s,0s}.sidebar-overview-active .sidebar-panel.site-overview-wrap,.sidebar-toc-active .sidebar-panel.post-toc-wrap{animation-name:activate-sidebar-panel;height:auto;opacity:1;pointer-events:unset;transform:translateY(0);transition-delay:0.2s,0.2s,0s;visibility:unset}.sidebar-panel.site-overview-wrap{display:flex;flex-direction:column;justify-content:center;gap:10px;justify-content:flex-start}@keyframes deactivate-sidebar-panel{from{height:var(--inactive-panel-height,0)}to{height:var(--active-panel-height,0)}}@keyframes activate-sidebar-panel{from{height:var(--inactive-panel-height,auto)}to{height:var(--active-panel-height,auto)}}.sidebar-toggle{bottom:61px;height:16px;padding:5px;width:16px;background:#222;cursor:pointer;opacity:.6;position:fixed;z-index:30;left:30px}.sidebar-toggle:hover{opacity:.8}@media (max-width:991px){.sidebar-toggle{left:20px;opacity:.8}}.sidebar-toggle:hover .toggle-line{background:#fc6423}@media (any-hover:hover){body:not(.sidebar-active) .sidebar-toggle:hover :first-child{left:50%;top:2px;transform:rotate(45deg);width:50%}body:not(.sidebar-active) .sidebar-toggle:hover :last-child{left:50%;top:-2px;transform:rotate(-45deg);width:50%}}.sidebar-active .sidebar-toggle :nth-child(2){opacity:0}.sidebar-active .sidebar-toggle :first-child{top:6px;transform:rotate(45deg)}.sidebar-active .sidebar-toggle :last-child{top:-6px;transform:rotate(-45deg)}.post-toc{font-size:.875em}.post-toc ol{list-style:none;margin:0;padding:0 2px 0 10px;text-align:left}.post-toc ol>:last-child{margin-bottom:5px}.post-toc ol>ol{padding-left:0}.post-toc ol a{transition:.2s ease-in-out}.post-toc .nav-item{line-height:1.8;overflow:hidden;text-overflow:ellipsis}.post-toc .nav .active>a{border-bottom-color:#fc6423;color:#fc6423}.post-toc .nav .active-current>a,.post-toc .nav .active-current>a:hover{color:#fc6423}.site-state{display:flex;flex-wrap:wrap;justify-content:center;line-height:1.4}.site-state-item{padding:0 15px}.site-state-item a{border-bottom:0;display:block}.site-state-item-count{display:block;font-size:1em;font-weight:600}.site-state-item-name{color:#999;font-size:.8125em}.sidebar-post-related{font-size:.8125em;padding:18px 0 0}.popular-posts{margin:0;padding:1em 0;text-align:left}.popular-posts .popular-posts-item{display:block}.popular-posts .popular-posts-item .popular-posts-link{border-bottom:0;display:block;padding:5px 20px;transition:background .2s ease-in-out}.popular-posts .popular-posts-item .popular-posts-link:hover{background:var(--menu-item-bg-color)}.popular-posts .popular-posts-item .popular-posts-time{color:#999}.footer{color:#999;font-size:.875em;padding:20px 0;transition:left .2s ease-in-out,right .2s ease-in-out}.footer.footer-fixed{bottom:0;left:0;position:absolute;right:0}.footer-inner{box-sizing:border-box;text-align:center;display:flex;flex-direction:column;justify-content:center;margin:0 auto;width:calc(100% - 20px)}@media (max-width:767px){.footer-inner{width:auto}}@media (min-width:1200px){.footer-inner{width:1160px}}@media (min-width:1600px){.footer-inner{width:73%}}.use-motion .footer{opacity:0}.languages{display:inline-block;font-size:1.125em;position:relative}.languages .lang-select-label span{margin:0 .5em}.languages .lang-select{height:100%;left:0;opacity:0;position:absolute;top:0;width:100%}.with-love{color:#e91e63;display:inline-block;margin:0 5px;animation:1.33s ease-in-out infinite icon-animate}@keyframes icon-animate{0%,100%{transform:scale(1)}10%,30%{transform:scale(.9)}20%,40%,50%,60%,70%,80%{transform:scale(1.1)}}@media (max-width:567px){.main-inner{padding:initial!important}.posts-expand .post-header{margin-bottom:10px!important}.post-block{margin-top:initial!important;padding:8px 18px!important}.post-body h1,.post-body h2,.post-body h3,.post-body h4,.post-body h5,.post-body h6{margin:20px 0 8px}.post-body .note h1,.post-body .note h2,.post-body .note h3,.post-body .note h4,.post-body .note h5,.post-body .note h6,.post-body .tabs .tab-content .tab-pane h1,.post-body .tabs .tab-content .tab-pane h2,.post-body .tabs .tab-content .tab-pane h3,.post-body .tabs .tab-content .tab-pane h4,.post-body .tabs .tab-content .tab-pane h5,.post-body .tabs .tab-content .tab-pane h6{margin:0 5px}.post-body>p{margin:0 0 10px}.post-body .note>p,.post-body .tabs .tab-content .tab-pane>p{padding:0 5px}.post-body img,.post-body video{margin-bottom:10px!important}.post-body .fancybox+figcaption,.post-body img+figcaption{margin:-5px auto 15px!important}.post-body .note{margin-bottom:10px!important;padding:10px!important}.post-body .note:not(.no-icon){padding-left:35px!important}.post-body .tabs .tab-content .tab-pane{padding:10px 10px 0!important}.post-eof{margin:40px auto 20px!important}.pagination{margin-top:40px}}.back-to-top{font-size:12px;margin:8px -10px -20px;opacity:0;transition:opacity .2s ease-in-out}.back-to-top span{margin-right:8px;display:none}.back-to-top .fa{text-align:center;width:26px}.back-to-top.back-to-top-on{cursor:pointer;opacity:.6}.back-to-top.back-to-top-on:hover{opacity:.8}.reading-progress-bar{--progress:0;background:#e91e63;height:2px;position:fixed;z-index:50;width:var(--progress);left:0;top:0}.rtl.post-body a,.rtl.post-body h1,.rtl.post-body h2,.rtl.post-body h3,.rtl.post-body h4,.rtl.post-body h5,.rtl.post-body h6,.rtl.post-body li,.rtl.post-body ol,.rtl.post-body p,.rtl.post-body ul{direction:rtl;font-family:UKIJ Ekran}.rtl.post-title{font-family:UKIJ Ekran}.post-button{margin-top:40px;text-align:center}.use-motion .collection-header,.use-motion .comments,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{visibility:hidden}.posts-collapse .post-content{margin-bottom:35px;margin-left:35px;position:relative}@media (max-width:767px){.posts-collapse .post-content{margin-left:0;margin-right:0}}.posts-collapse .post-content .collection-title{font-size:1.125em;position:relative}.posts-collapse .post-content .collection-title::before{background:#999;border:1px solid #fff;margin-left:-6px;margin-top:-4px;position:absolute;top:50%;border-radius:50%;content:' ';height:10px;width:10px}.posts-collapse .post-content .collection-year{font-size:1.5em;font-weight:700;margin:60px 0;position:relative}.posts-collapse .post-content .collection-year .collection-year-count{font-size:.75em;background:#ccc;border-radius:10px;color:var(--content-bg-color);font-weight:700;line-height:1;margin-left:.35em;padding:2px 5px;text-shadow:1px 1px 0 rgba(0,0,0,.1)}.posts-collapse .post-content .collection-year::before{background:#bbb;margin-left:-4px;margin-top:-4px;position:absolute;top:50%;border-radius:50%;content:' ';height:8px;width:8px}.posts-collapse .post-content .collection-header{display:block;margin-left:20px}.posts-collapse .post-content .collection-header small{color:#bbb;margin-left:5px}.posts-collapse .post-content .post-header{border-bottom:1px dashed #ccc;margin:30px 2px 0;padding-left:15px;position:relative;transition:border .2s ease-in-out}.posts-collapse .post-content .post-header::before{background:#bbb;border:1px solid #fff;left:-6px;position:absolute;top:.75em;transition:background .2s ease-in-out;border-radius:50%;content:' ';height:6px;width:6px}.posts-collapse .post-content .post-header:hover{border-bottom-color:#666}.posts-collapse .post-content .post-header:hover::before{background:#222}.posts-collapse .post-content .post-meta-container{display:inline;font-size:.75em;margin-right:10px}.posts-collapse .post-content .post-title{display:inline}.posts-collapse .post-content .post-title a{border-bottom:0;color:var(--link-color)}.posts-collapse .post-content .post-title .fa{font-size:.875em;margin-left:5px}.posts-collapse .post-content::before{background:#f5f5f5;content:' ';height:100%;margin-left:-2px;position:absolute;top:1.25em;width:4px}.post-body{font-family:Lato,'PingFang SC','Microsoft YaHei',sans-serif;overflow-wrap:break-word}@media (min-width:1200px){.post-body{font-size:1.125em}}@media (min-width:992px){.post-body{text-align:justify}}.post-body h1 .header-anchor,.post-body h1 .headerlink,.post-body h2 .header-anchor,.post-body h2 .headerlink,.post-body h3 .header-anchor,.post-body h3 .headerlink,.post-body h4 .header-anchor,.post-body h4 .headerlink,.post-body h5 .header-anchor,.post-body h5 .headerlink,.post-body h6 .header-anchor,.post-body h6 .headerlink{border-bottom-style:none;color:inherit;float:right;font-size:.875em;margin-left:10px;opacity:0}.post-body h1 .header-anchor::before,.post-body h1 .headerlink::before,.post-body h2 .header-anchor::before,.post-body h2 .headerlink::before,.post-body h3 .header-anchor::before,.post-body h3 .headerlink::before,.post-body h4 .header-anchor::before,.post-body h4 .headerlink::before,.post-body h5 .header-anchor::before,.post-body h5 .headerlink::before,.post-body h6 .header-anchor::before,.post-body h6 .headerlink::before{content:'\f0c1';font-family:'Font Awesome 6 Free';font-weight:900}.post-body h1:hover .header-anchor,.post-body h1:hover .headerlink,.post-body h2:hover .header-anchor,.post-body h2:hover .headerlink,.post-body h3:hover .header-anchor,.post-body h3:hover .headerlink,.post-body h4:hover .header-anchor,.post-body h4:hover .headerlink,.post-body h5:hover .header-anchor,.post-body h5:hover .headerlink,.post-body h6:hover .header-anchor,.post-body h6:hover .headerlink{opacity:.5}.post-body h1:hover .header-anchor:hover,.post-body h1:hover .headerlink:hover,.post-body h2:hover .header-anchor:hover,.post-body h2:hover .headerlink:hover,.post-body h3:hover .header-anchor:hover,.post-body h3:hover .headerlink:hover,.post-body h4:hover .header-anchor:hover,.post-body h4:hover .headerlink:hover,.post-body h5:hover .header-anchor:hover,.post-body h5:hover .headerlink:hover,.post-body h6:hover .header-anchor:hover,.post-body h6:hover .headerlink:hover{opacity:1}.post-body .exturl .fa{font-size:.875em;margin-left:4px}.post-body .fancybox+figcaption,.post-body img+figcaption{color:#999;font-size:.875em;font-weight:700;line-height:1;margin:-15px auto 15px;text-align:center}.post-body embed,.post-body iframe,.post-body img,.post-body video{margin-bottom:20px}.post-body .video-container{height:0;margin-bottom:20px;overflow:hidden;padding-top:75%;position:relative;width:100%}.post-body .video-container embed,.post-body .video-container iframe,.post-body .video-container object{height:100%;left:0;margin:0;position:absolute;top:0;width:100%}.post-gallery{display:flex;min-height:200px}.post-gallery .post-gallery-image{flex:1}.post-gallery .post-gallery-image:not(:first-child){clip-path:polygon(40px 0,100% 0,100% 100%,0 100%);margin-left:-20px}.post-gallery .post-gallery-image:not(:last-child){margin-right:-20px}.post-gallery .post-gallery-image img{height:100%;object-fit:cover;opacity:1;width:100%}.posts-expand .post-gallery{margin-bottom:60px}.posts-collapse .post-gallery{margin:15px 0}.posts-expand .post-header{font-size:1.125em;margin-bottom:60px;text-align:center}.posts-expand .post-title{font-size:1.5em;font-weight:400;margin:initial;overflow-wrap:break-word}.posts-expand .post-title .post-edit-link{border-bottom:0;color:#bbb;float:right;font-size:1.25em;margin-left:-1.2em;transition:color .2s ease-in}@media (max-width:567px){.posts-expand .post-title .post-edit-link{margin-left:initial}}.posts-expand .post-title .post-edit-link:hover{color:#fc6423}.posts-expand .post-title-link{border-bottom:0;color:var(--link-color);display:inline-block;position:relative}.posts-expand .post-title-link::before{background:var(--link-color);bottom:0;content:'';height:2px;left:0;position:absolute;transform:scaleX(0);transition:transform .2s ease-in-out;width:100%}.posts-expand .post-title-link:hover::before{transform:scaleX(1)}.posts-expand .post-title-link .fa{font-size:.875em;margin-left:5px}.post-sticky-flag{display:inline-block;margin-right:8px;transform:rotate(30deg)}.posts-expand .post-meta-container{color:#999;font-family:Lato,'PingFang SC','Microsoft YaHei',sans-serif;font-size:.75em;margin-top:3px}.posts-expand .post-meta-container .post-description{font-size:.875em;margin-top:2px}.posts-expand .post-meta-container time{border-bottom:1px dashed #999}.post-meta{display:flex;flex-wrap:wrap;justify-content:center}:not(.post-meta-break)+.post-meta-item::before{content:'|';margin:0 .5em}.post-meta-item-icon{margin-right:3px}@media (max-width:991px){.post-body{text-align:justify}.post-meta-item-text{display:none}}.post-meta-break{flex-basis:100%;height:0}.post-nav{border-top:1px solid #eee;display:flex;gap:30px;justify-content:space-between;margin-top:1em;padding:10px 5px 0}.post-nav-item{flex:1}.post-nav-item a{border-bottom:0;display:block;font-size:.875em;line-height:1.6}.post-nav-item a:active{top:2px}.post-nav-item .fa{font-size:.75em}.post-nav-item:first-child .fa{margin-right:5px}.post-nav-item:last-child{text-align:right}.post-nav-item:last-child .fa{margin-left:5px}.post-footer{display:flex;flex-direction:column;justify-content:center}.post-eof{background:#ccc;height:1px;margin:80px auto 60px;width:8%}.post-block:last-of-type .post-eof{display:none}.post-copyright ul{list-style:none;overflow:hidden;padding:.5em 1em;position:relative;background:var(--card-bg-color);border-left:3px solid #ff2a2a;margin:1em 0 0}.post-copyright ul::after{content:'\f25e';font-family:'Font Awesome 6 Brands';font-size:200px;opacity:.1;position:absolute;right:-50px;top:-150px}.post-tags{margin-top:40px;text-align:center}.post-tags a{display:inline-block;font-size:.8125em}.post-tags a:not(:last-child){margin-right:10px}.social-like{border-top:1px solid #eee;font-size:.875em;margin-top:1em;padding-top:1em;display:flex;flex-wrap:wrap;justify-content:center}.social-like a{border-bottom:none}.reward-container{margin:1em 0 0;padding:1em 0;text-align:center}.reward-container button{background:0 0;color:#fc6423;cursor:pointer;line-height:2;padding:0 15px;border:2px solid #fc6423;border-radius:2px;outline:0;vertical-align:text-top}.reward-container button:hover{background:#fc6423;color:#fff}.post-reward{display:none;padding-top:20px}.post-reward.active{display:block}.post-reward div{display:inline-block}.post-reward div span{display:block}.post-reward img{display:inline-block;margin:.8em 2em 0;max-width:100%;width:180px}@keyframes next-roll{from{transform:rotateZ(30deg)}to{transform:rotateZ(-30deg)}}.category-all-page .category-all-title{text-align:center}.category-all-page .category-all{margin-top:20px}.category-all-page .category-list{list-style:none;margin:0;padding:0}.category-all-page .category-list-item{margin:5px 10px}.category-all-page .category-list-count{font-size:.75em;background:#ccc;border-radius:10px;color:var(--content-bg-color);font-weight:700;line-height:1;margin-left:.35em;padding:2px 5px;text-shadow:1px 1px 0 rgba(0,0,0,.1)}.category-all-page .category-list-child{padding-left:10px}.event-list hr{background:#222;margin:20px 0 45px}.event-list hr::after{background:#222;color:#fff;content:'NOW';display:inline-block;font-weight:700;padding:0 5px}.event-list .event{--event-background:#222;--event-foreground:#bbb;--event-title:#fff;background:var(--event-background);padding:15px}.event-list .event .event-summary{border-bottom:0;color:var(--event-title);margin:0;padding:0 0 0 35px;position:relative}.event-list .event .event-summary::before{animation:1s ease-in-out infinite alternate dot-flash;background:var(--event-title);left:0;margin-top:-6px;position:absolute;top:50%;border-radius:50%;content:' ';height:12px;width:12px}.event-list .event:nth-of-type(odd) .event-summary::before{animation-delay:.5s}.event-list .event:not(:last-child){margin-bottom:20px}.event-list .event .event-relative-time{color:var(--event-foreground);display:inline-block;font-size:12px;font-weight:400;padding-left:12px}.event-list .event .event-details{color:var(--event-foreground);display:block;line-height:18px;padding:6px 0 6px 35px}.event-list .event .event-details::before{color:var(--event-foreground);display:inline-block;margin-right:9px;width:14px;font-family:'Font Awesome 6 Free';font-weight:900}.event-list .event .event-details.event-location::before{content:'\f041'}.event-list .event .event-details.event-duration::before{content:'\f017'}.event-list .event .event-details.event-description::before{content:'\f024'}.event-list .event-past{--event-background:#f5f5f5;--event-foreground:#999;--event-title:#222}@keyframes dot-flash{from{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}ul.breadcrumb{font-size:.75em;list-style:none;margin:1em 0;padding:0 2em;text-align:center}ul.breadcrumb li{display:inline}ul.breadcrumb li:not(:first-child)::before{content:'/\00a0';font-weight:400;padding:.5em}ul.breadcrumb li:last-child{font-weight:700}.tag-cloud{text-align:center}.tag-cloud a{display:inline-block;margin:10px}.tag-cloud-0{border-bottom-color:#aaa;color:#aaa}.tag-cloud-1{border-bottom-color:#9a9a9a;color:#9a9a9a}.tag-cloud-2{border-bottom-color:#8b8b8b;color:#8b8b8b}.tag-cloud-3{border-bottom-color:#7c7c7c;color:#7c7c7c}.tag-cloud-4{border-bottom-color:#6c6c6c;color:#6c6c6c}.tag-cloud-5{border-bottom-color:#5d5d5d;color:#5d5d5d}.tag-cloud-6{border-bottom-color:#4e4e4e;color:#4e4e4e}.tag-cloud-7{border-bottom-color:#3e3e3e;color:#3e3e3e}.tag-cloud-8{border-bottom-color:#2f2f2f;color:#2f2f2f}.tag-cloud-9{border-bottom-color:#202020;color:#202020}.tag-cloud-10{border-bottom-color:#111;color:#111}.gt-comments a,.gt-header a,.gt-popup a{border-bottom:0}.gt-container .gt-popup .gt-action.is--active::before{top:.7em}.search-active{overflow:hidden}.search-pop-overlay{background:rgba(0,0,0,0);display:flex;height:100%;left:0;position:fixed;top:0;transition:visibility .4s,background .4s;visibility:hidden;width:100%;z-index:40}.search-active .search-pop-overlay{background:rgba(0,0,0,.3);visibility:visible}.search-popup{background:var(--card-bg-color);border-radius:5px;height:80%;margin:auto;transform:scale(0);transition:transform .4s;width:700px}.search-active .search-popup{transform:scale(1)}@media (max-width:767px){.search-popup{border-radius:0;height:100%;width:100%}}.search-popup .popup-btn-close,.search-popup .search-icon{color:#999;font-size:18px;padding:0 10px}.search-popup .popup-btn-close{cursor:pointer}.search-popup .popup-btn-close:hover .fa{color:#222}.search-popup .search-header{background:#eee;border-top-left-radius:5px;border-top-right-radius:5px;display:flex;padding:5px}.search-popup input.search-input{background:0 0;border:0;outline:0;width:100%}.search-popup input.search-input::-webkit-search-cancel-button{display:none}.search-popup .search-result-container{display:flex;flex-direction:column;height:calc(100% - 55px);overflow:auto;padding:5px 25px}.search-popup .search-result-container hr{flex-shrink:0;margin:5px 0 10px}.search-popup .search-result-container hr:first-child{display:none}.search-popup .search-result-list{margin:0 5px;padding:0}.search-popup a.search-result-title{font-weight:700}.search-popup p.search-result{border-bottom:1px dashed #ccc;padding:5px 0}.search-popup .search-input-container{flex-grow:1;padding:2px}.search-popup .search-result-icon{color:#ccc;margin:auto}mark.search-keyword{background:0 0;border-bottom:1px dashed #ff2a2a;color:#ff2a2a;font-weight:700}.use-motion .animated{animation-fill-mode:none;visibility:inherit}.use-motion .sidebar .animated{animation-fill-mode:both}header.header{background:var(--content-bg-color);border-radius:initial;box-shadow:initial}.main{align-items:stretch;display:flex;justify-content:space-between;margin:0 auto;width:calc(100% - 20px)}@media (max-width:767px){.main{width:auto}}@media (min-width:1200px){.main{width:1160px}}@media (min-width:1600px){.main{width:73%}}@media (max-width:991px){header.header{border-radius:initial}.main{display:block;width:auto}}.main-inner{border-radius:initial;box-sizing:border-box;width:calc(100% - 252px)}.footer-inner{padding-left:252px}@media (max-width:991px){.main-inner{border-radius:initial;width:100%}.footer-inner{padding-left:0;padding-right:0;width:auto}}.column{width:240px}.site-brand-container{background:var(--theme-color)}.site-meta{padding:20px 0}.site-nav-right .toggle,.site-nav-toggle .toggle{color:#fff}.site-nav-right .toggle .toggle-line,.site-nav-toggle .toggle .toggle-line{background:#fff}@media (min-width:768px) and (max-width:991px){.site-nav-right,.site-nav-toggle{display:flex;flex-direction:column;justify-content:center}.site-nav{--scroll-height:0;height:0;overflow:hidden;transition:height .2s ease-in-out,visibility .2s ease-in-out;visibility:hidden}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height);visibility:unset}}.menu .menu-item{display:block;margin:0}.menu .menu-item a{padding:5px 20px;position:relative;transition-property:background-color;display:flex;align-items:center}.menu .menu-item a .badge{margin-left:auto}.menu .menu-item a.menu-item-active::after{background:#bbb;border-radius:50%;content:' ';height:6px;margin-top:-3px;position:absolute;right:15px;top:50%;width:6px}.sub-menu{margin:0;padding:6px 0}.sub-menu .menu-item{display:inline-block}.sub-menu .menu-item a{background:0 0;margin:5px 10px;padding:initial}.sub-menu .menu-item a:hover{background:0 0;color:#fc6423}.sub-menu .menu-item-active{border-bottom-color:#fc6423;color:#fc6423}.sub-menu .menu-item-active:hover{border-bottom-color:#fc6423}@media (min-width:992px){.sidebar{position:-webkit-sticky;position:sticky;top:12px}.sidebar-toggle{display:none}.sidebar-inner{background:var(--content-bg-color);border-radius:initial;box-shadow:initial;box-sizing:border-box;color:var(--text-color);margin-top:12px;max-height:calc(100vh - 24px);visibility:hidden}.site-state-item{padding:0 10px}.sidebar .sidebar-button{border-bottom:1px dotted #ccc;border-top:1px dotted #ccc}.sidebar .sidebar-button button{border:0;color:#fc6423;display:block;width:100%}.sidebar .sidebar-button button:hover{background:0 0;border:0;color:#e34603}.links-of-author{display:flex;flex-wrap:wrap;justify-content:center}.links-of-author-item{margin:5px 0 0}.links-of-author-item a{box-sizing:border-box;max-width:100%;overflow:hidden;padding:0 5px;text-overflow:ellipsis;white-space:nowrap;border-bottom:0;border-radius:4px;display:block}.links-of-author-item a:hover{background:var(--body-bg-color)}.back-to-top{background:var(--body-bg-color);margin:-4px -10px -18px;transition-property:bottom,margin-top}.back-to-top.back-to-top-on{margin-top:16px}}.main-inner{background:var(--content-bg-color);box-shadow:initial;padding:40px}@media (max-width:991px){.column{width:auto}.site-nav-on .site-brand-container{box-shadow:0 0 16px rgba(0,0,0,.5)}.menu .menu-item.menu-item-search{display:none}.main-inner{padding:20px}}.sub-menu{border-bottom:1px solid #ddd}.post-block:first-of-type{padding-top:40px}@media (max-width:767px){.pagination{margin-bottom:10px}}@media (min-width:992px) and (max-width:991px){.sidebar{display:none}}</style><link crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css integrity=sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E= rel=stylesheet><link crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css integrity=sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE= rel=stylesheet><script class=next-config data-name=main type=application/json>{"hostname":"hyperscalar.pages.dev","root":"/zh/","images":"/zh/images","scheme":"Pisces","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#E91E63","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/zh/search.xml","localsearch":{"enable":true,"top_n_per_article":-1,"unescape":true,"preload":true,"trigger":"auto"}}</script><script src=/zh/js/config-b6e321ce.js></script><meta content="原标题：利用空间局部性原理大幅优化数据库查询量级  ¶ 局部性原理 程序的局部性原理是指程序在执行时呈现出局部性规律，即在一段时间内，整个程序的执行仅限于程序中的某一部分。相应地，执行期间所访问的存储空间也局限于某个内存区域。 局部性原理又可分为：  时间局部性：是指如果程序中的某条指令一旦执行，则不久之后该指令可能再次被执行；如果某数据被访问，则不久之后该数据可能再次被访问。比如在函数调用的时" name=description><meta content=article property=og:type><meta content="如何仅通过本地缓存就将数据库查询量级从 71.7 万 / 秒降至 1.4 万 / 秒" property=og:title><meta content=https://hyperscalar.pages.dev/zh/posts/Locality-of-Reference-and-Cache/index.html property=og:url><meta content=回锅录 property=og:site_name><meta content="原标题：利用空间局部性原理大幅优化数据库查询量级  ¶ 局部性原理 程序的局部性原理是指程序在执行时呈现出局部性规律，即在一段时间内，整个程序的执行仅限于程序中的某一部分。相应地，执行期间所访问的存储空间也局限于某个内存区域。 局部性原理又可分为：  时间局部性：是指如果程序中的某条指令一旦执行，则不久之后该指令可能再次被执行；如果某数据被访问，则不久之后该数据可能再次被访问。比如在函数调用的时" property=og:description><meta content=zh_CN property=og:locale><meta content=https://hyperscalar.pages.dev/zh/posts/Locality-of-Reference-and-Cache/Quicksort-Animation.gif property=og:image><meta content=https://hyperscalar.pages.dev/zh/posts/Locality-of-Reference-and-Cache/Heapsort-Animation.gif property=og:image><meta content=https://hyperscalar.pages.dev/zh/posts/Locality-of-Reference-and-Cache/Memory-Hierarchy.svg property=og:image><meta content=2024-12-17T16:00:00.000Z property=article:published_time><meta content=2024-12-22T16:18:53.633Z property=article:modified_time><meta content=回锅肉 property=article:author><meta content=性能工程 property=article:tag><meta content=计算机体系结构 property=article:tag><meta content=分布式系统 property=article:tag><meta content=实践经验 property=article:tag><meta content=summary name=twitter:card><meta content=https://hyperscalar.pages.dev/zh/posts/Locality-of-Reference-and-Cache/Quicksort-Animation.gif name=twitter:image><link href=https://hyperscalar.pages.dev/zh/posts/Locality-of-Reference-and-Cache/ rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://hyperscalar.pages.dev/zh/posts/Locality-of-Reference-and-Cache/","path":"posts/Locality-of-Reference-and-Cache/","title":"如何仅通过本地缓存就将数据库查询量级从 71.7 万 / 秒降至 1.4 万 / 秒"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>如何仅通过本地缓存就将数据库查询量级从 71.7 万 / 秒降至 1.4 万 / 秒 | 回锅录</title><noscript><link href=/zh/css/noscript-7538a97a.css rel=stylesheet></noscript><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}</style><body class=use-motion itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label=切换导航栏 class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/zh/ rel=start> <i class=logo-line></i> <p class=site-title>回锅录</p> <i class=logo-line></i> </a><p class=site-subtitle itemprop=description>学习 & 探索</div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=搜索 role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/zh/ rel=section><i class="fa fa-home fa-fw"></i>首页</a><li class="menu-item menu-item-about"><a href=/zh/about/ rel=section><i class="fa fa-user fa-fw"></i>关于</a><li class="menu-item menu-item-courses"><a href=/zh/courses/ rel=section><i class="fa fa-university fa-fw"></i>课程</a><li class="menu-item menu-item-books"><a href=/zh/books/ rel=section><i class="fa fa-book fa-fw"></i>书籍</a><li class="menu-item menu-item-papers"><a href=/zh/papers/ rel=section><i class="fa fa-paper-plane fa-fw"></i>论文</a><li class="menu-item menu-item-categories"><a href=/zh/categories/ rel=section><i class="fa fa-th fa-fw"></i>分类</a><li class="menu-item menu-item-tags"><a href=/zh/tags/ rel=section><i class="fa fa-tags fa-fw"></i>标签</a><li class="menu-item menu-item-archives"><a href=/zh/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>搜索 </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=搜索... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class=search-result-container><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录<li class=sidebar-nav-overview>站点概览</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%B1%80%E9%83%A8%E6%80%A7%E5%8E%9F%E7%90%86><span class=nav-number>1.</span> <span class=nav-text> 局部性原理</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%BC%93%E5%AD%98><span class=nav-number>2.</span> <span class=nav-text> 缓存</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%BC%93%E5%AD%98%E5%8F%8B%E5%A5%BD%E6%80%A7><span class=nav-number>3.</span> <span class=nav-text> 缓存友好性</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8%E5%B1%80%E9%83%A8%E6%80%A7%E5%8E%9F%E7%90%86><span class=nav-number>4.</span> <span class=nav-text> 分布式系统中如何利用局部性原理</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AD%98%E5%82%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84><span class=nav-number>4.1.</span> <span class=nav-text> 分布式系统的存储层次结构</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%9C%A8%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%88%A9%E7%94%A8%E6%97%B6%E9%97%B4%E5%B1%80%E9%83%A8%E6%80%A7><span class=nav-number>4.2.</span> <span class=nav-text> 在分布式系统中利用时间局部性</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%9C%A8%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%88%A9%E7%94%A8%E7%A9%BA%E9%97%B4%E5%B1%80%E9%83%A8%E6%80%A7><span class=nav-number>4.3.</span> <span class=nav-text> 在分布式系统中利用空间局部性</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%AE%9E%E8%B7%B5%E6%A1%88%E4%BE%8B><span class=nav-number>5.</span> <span class=nav-text> 实践案例</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E8%83%8C%E6%99%AF%E4%B8%8E%E6%8C%91%E6%88%98><span class=nav-number>5.1.</span> <span class=nav-text> 背景与挑战</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%BA%94%E5%AF%B9%E6%8E%AA%E6%96%BD><span class=nav-number>5.2.</span> <span class=nav-text> 应对措施</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%88%9D%E6%8E%A2%E7%A9%BA%E9%97%B4%E5%B1%80%E9%83%A8%E6%80%A7><span class=nav-number>5.3.</span> <span class=nav-text> 初探空间局部性</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%8E%A8%E5%90%91%E6%9E%81%E9%99%90><span class=nav-number>5.4.</span> <span class=nav-text> 推向极限</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E9%95%BF%E6%9C%9F%E8%A1%A8%E7%8E%B0><span class=nav-number>5.5.</span> <span class=nav-text> 长期表现</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E9%A3%8E%E9%99%A9><span class=nav-number>5.6.</span> <span class=nav-text> 风险</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%9B%9E%E9%A1%BE><span class=nav-number>5.7.</span> <span class=nav-text> 回顾</span></a></ol></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><img alt=回锅肉 class=site-author-image itemprop=image src=/zh/images/avatar-batman.png><p class=site-author-name itemprop=name>回锅肉<div class=site-description itemprop=description>不变初心，特立独行。</div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/zh/archives/> <span class=site-state-item-count>4</span> <span class=site-state-item-name>日志</span> </a></div><div class="site-state-item site-state-categories"><a href=/zh/categories/> <span class=site-state-item-count>5</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/zh/tags/> <span class=site-state-item-count>8</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author animated"><span class=links-of-author-item> <a rel="noopener me external nofollow noreferrer" title="GitHub → https://github.com/hyperscalar" href=https://github.com/hyperscalar target=_blank><i class="fab fa-github fa-fw"></i></a> </span></div><div class="cc-license animated" itemprop=license><a rel="noopener external nofollow noreferrer" class=cc-opacity href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img alt="Creative Commons" src=https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg></a></div></div></div><div class="back-to-top animated" aria-label=返回顶部 role=button><i class="fa fa-arrow-up"></i><span>0%</span></div></div><div class="sidebar-inner sidebar-blogroll"><div class="links-of-blogroll animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i> 链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://hyperscalar.pages.dev/ title=https://hyperscalar.pages.dev>首页</a></ul></div></div><div class=pjax></div></aside></div><div class="main-inner post posts-expand"><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article lang=zh-CN><link href=https://hyperscalar.pages.dev/zh/posts/Locality-of-Reference-and-Cache/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/zh/images/avatar-batman.png itemprop=image> <meta content=回锅肉 itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=回锅录 itemprop=name> <meta content=不变初心，特立独行。 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="如何仅通过本地缓存就将数据库查询量级从 71.7 万 / 秒降至 1.4 万 / 秒 | 回锅录" itemprop=name> <meta itemprop=description> </span><header class=post-header><h1 itemprop="name headline" class=post-title>如何仅通过本地缓存就将数据库查询量级从 71.7 万 / 秒降至 1.4 万 / 秒<a rel="noopener external nofollow noreferrer" class=post-edit-link href=https://github.com/hyperscalar/blogs/blob/main/zh/source/_posts/Locality-of-Reference-and-Cache.md target=_blank title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2024-12-18 00:00:00" datetime=2024-12-18T00:00:00+08:00>2024-12-18</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2024-12-23 00:18:53" datetime=2024-12-23T00:18:53+08:00 itemprop=dateModified>2024-12-23</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/zh/categories/%E7%BC%93%E5%AD%98/ itemprop=url rel=index><span itemprop=name>缓存</span></a> </span> </span><span class=post-meta-break></span><span class=post-meta-item title=本文字数> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>本文字数：</span> <span>6.3k</span> </span><span class=post-meta-item title=阅读时长> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>阅读时长 ≈</span> <span>23 分钟</span> </span></div></div></header><div class=post-body itemprop=articleBody><blockquote><p>原标题：利用空间局部性原理大幅优化数据库查询量级</blockquote><h2 id=局部性原理><a class=header-anchor href=#局部性原理>¶</a> 局部性原理</h2><p>程序的局部性原理是指程序在执行时呈现出局部性规律，即在一段时间内，整个程序的执行仅限于程序中的某一部分。相应地，执行期间所访问的存储空间也局限于某个内存区域。<p>局部性原理又可分为：<ul><li><strong>时间局部性</strong>：是指如果程序中的某条指令一旦执行，则不久之后该指令可能再次被执行；如果某数据被访问，则不久之后该数据可能再次被访问。比如在函数调用的时候，前不久才使用过的函数参数或局部变量容易再度被调取使用；<li><strong>空间局部性</strong>：是指一旦程序访问了某个存储单元，则不久之后，其附近的存储单元也将被访问。空间局部性比较常见于循环中，比如在一个数组中，如果第 3 个元素在上一个循环中使用，则本次循环中极有可能会使用第 4 个元素。</ul><span id=more></span><h2 id=缓存><a class=header-anchor href=#缓存>¶</a> 缓存</h2><p>正是由于程序的局部性，将热点数据放置到更快的存储设备上，那么将极大的提升程序的执行效率，这便是缓存。其本质是用空间换时间，牺牲数据的实时性，以近端暂存的历史数据代替远端最新的数据，从而减少访问内存、网络 IO 等高开销操作，以提升程序的性能表现。<h2 id=缓存友好性><a class=header-anchor href=#缓存友好性>¶</a> 缓存友好性</h2><p>由于缓存的有效性由程序的局部性来支持，因此衡量程序是否缓存友好，即衡量其局部性的强弱。<p>关于缓存友好性，有一个经典的案例：堆排序有着最强的理论性能一一最坏时间复杂度 <mjx-container class=MathJax jax=SVG><svg style="vertical-align: -0.566ex;" viewbox="0 -750 4001 1000" focusable=false height=2.262ex role=img width=9.052ex xmlns=http://www.w3.org/2000/svg><g fill=currentColor stroke=currentColor stroke-width=0 transform=scale(1,-1)><g data-mml-node=math><g data-mml-node=mi><path d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z" data-c=1D442></path></g><g data-mml-node=mo transform=translate(763,0)><path d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" data-c=28></path></g><g data-mml-node=mi transform=translate(1152,0)><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" data-c=1D45B></path></g><g data-mml-node=mi transform=translate(1752,0)><path d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z" data-c=1D459></path></g><g data-mml-node=mi transform=translate(2050,0)><path d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z" data-c=1D45C></path></g><g data-mml-node=mi transform=translate(2535,0)><path d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z" data-c=1D454></path></g><g data-mml-node=mi transform=translate(3012,0)><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" data-c=1D45B></path></g><g data-mml-node=mo transform=translate(3612,0)><path d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" data-c=29></path></g></g></g></svg></mjx-container>，但在实际应用性能表现通常却不如最坏时间复杂度 <mjx-container class=MathJax jax=SVG><svg style="vertical-align: -0.566ex;" viewbox="0 -833.9 2577.6 1083.9" focusable=false height=2.452ex role=img width=5.832ex xmlns=http://www.w3.org/2000/svg><g fill=currentColor stroke=currentColor stroke-width=0 transform=scale(1,-1)><g data-mml-node=math><g data-mml-node=mi><path d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z" data-c=1D442></path></g><g data-mml-node=mo transform=translate(763,0)><path d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" data-c=28></path></g><g data-mml-node=msup transform=translate(1152,0)><g data-mml-node=mi><path d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z" data-c=1D45B></path></g><g transform="translate(633,363) scale(0.707)" data-mml-node=mn><path d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" data-c=32></path></g></g><g data-mml-node=mo transform=translate(2188.6,0)><path d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" data-c=29></path></g></g></g></svg></mjx-container> 的快速排序，便是由于堆排序的访存空间局部性太差，导致其缓存友好性很差，进而在现代计算机体系结构中吃了大亏。<p>快速排序</p><img data-src=/zh/posts/Locality-of-Reference-and-Cache/Quicksort-Animation.gif title=快速排序示例动画，来自维基百科><p>可以发现其分治算法的特性会使得其对内存的访问局限在一定的范围，从而具备了较好的空间局部性。<p>堆排序</p><img data-src=/zh/posts/Locality-of-Reference-and-Cache/Heapsort-Animation.gif title=快速排序示例动画，来自维基百科><p>可以发现其对于内存的访问模式相对 “跳跃”，这导致了较差的空间局部性。<h2 id=分布式系统中如何利用局部性原理><a class=header-anchor href=#分布式系统中如何利用局部性原理>¶</a> 分布式系统中如何利用局部性原理</h2><h3 id=分布式系统的存储层次结构><a class=header-anchor href=#分布式系统的存储层次结构>¶</a> 分布式系统的存储层次结构</h3><img data-src=/zh/posts/Locality-of-Reference-and-Cache/Memory-Hierarchy.svg title=分布式系统中的存储层次结构><h3 id=在分布式系统中利用时间局部性><a class=header-anchor href=#在分布式系统中利用时间局部性>¶</a> 在分布式系统中利用时间局部性</h3><p>在了解如何在分布式系统中利用时间局部性之前，我们先来了解在单机的计算机体系结构层面是如何利用时间局部性的。<p>以 Apple M1 为例，其搭载了堪称豪华的超大规模、多级片上缓存：<table><tbody><tr><th><th>低功耗核心（Icestorm）<th>高性能核心（Firestorm）<tr><th>L1 指令<td>128 KB x 4<td>192 KB x 4<tr><th>L1 数据<td>64 KB x 4<td>128 KB x 4<tr><th>L2<td>4 MB（低功耗核心共享）<td>12 MB（高性能核心共享）<tr><th>SLC<td align=center colspan=2>8MB（全片共享）</table><p>其具备以下特点：<ol><li><strong>代码指令和程序数据分离</strong>：在 L1 缓存中，由于代码指令和程序数据通常在体积层面差距较大，而 L1 缓存容量较小，如果不进行分离，那么可能导致绝大部分 L1 缓存被程序数据占据，导致代码指令的缓存命中率低下，从而影响性能；<li><strong>多级缓存</strong>：从 L1 到 L2 再到 SLC，速度依次下降，容量依次增大。数据的局部性越强，那么就越可能被更快的 L1、L2 命中；<li><strong>独占和共享相结合</strong>：L1 缓存为每个核心独占，L2 缓存在核心簇内共享，而 SLC 则在整个 SOC 层面共享（包括 CPU、GPU、NPU 等）。</ol><p>我们来看如何将上述的策略运用到分布式系统集群中：<ol><li>代码指令和程序数据分离 —— 配置数据缓存与用户数据缓存甚至不同场景或不同用途的缓存都尽量分离；<li>多级缓存策略 —— 单机缓存、分布式缓存的多级缓存策略；<li>独占和共享相结合 —— 本地缓存单机独占、分布式缓存集群共享。</ol><p>通过上述缓存策略的合理运用，我们能够尽可能的挖掘程序中的时间局部性，同时能够平衡不同缓存在速度、容量、成本之间的差异。<h3 id=在分布式系统中利用空间局部性><a class=header-anchor href=#在分布式系统中利用空间局部性>¶</a> 在分布式系统中利用空间局部性</h3><p>在了解如何在分布式系统中利用空间局部性之前，我们先来了解在单机的计算机体系结构层面是如何利用空间局部性的。<p>众所周知，内存（RAM）的最小寻址单元是字节（byte），也就是说字节是内存中原子单元，不可再细分。这也就是为什么布尔（boolean）类型明明只包含一个比特（bit）的信息，但一般也必须要用一个字节在内存中存储。<p>那么 CPU 中的 L1、L2 等高速缓存也是以字节为原子单元吗？<p>是也不是：<ul><li>由于高速缓存一般对指令集透明，其必须要和内存保持一致的按字节寻址的特性，因此对于缓存的访问而言，其原子单元和内存一致，为字节；<li>但对于缓存的加载而言，其原子单元却并不是和内存一致的字节，而是缓存行（Cache Line），以上面提到的 M1 处理器为例，其缓存行大小（Cache Line Size）为 128 字节。也就是说，如果出现缓存不命中，需要从内存中加载数据到缓存中时，即使我访问的只是内存中的一个字节，那么缓存也会把这个字节所在的缓存行，也就是 128 个字节的数据全部加载到缓存中。</ul><p>那么为什么缓存在加载的时候不只加载所需的数据，而是要加载整个缓存行？这不会造成浪费吗？<p>具体原因大致为以下几点：<ul><li>缓存行的设计可以充分利用现代 DRAM 的突发模式（Burst mode）特性，大幅提高访存吞吐量和减少延迟，这里具体不展开；<li>如果能提升系统的整体性能，一定程度的局部浪费是完全可以接受的。比如 CPU 中的分支预测特性也体现了类似的思路；<li>浪费的程度实际上取决于程序的空间局部性是否明显，局部性越明显，那么浪费就越小；<li>理论上缓存行的大小越大，那么对于局部性强的程序的性能提升也就越明显。当然，缓存行的大小还要受到其他各种物理因素的制约，并不能想多大就多大，也不是越大越好。</ul><p>可以看到，缓存行的设计目标很大程度上就是为了挖掘程序的空间局部性以提升性能。又或者说鼓励程序的空间局部性，空间局部性强的程序在这套机制下会得到性能的提升，而空间局部性差的程序在这套机制下会得到性能惩罚，正如前面提到的快速排序和堆排序。<p>因此，要想利用空间局部性的关键就在于：在加载缓存数据的时候，不仅要加载当前所需的数据，还要把 “相邻” 的一部分数据也一并加载进来，即：缓存的数据加载粒度 > 缓存的数据查询粒度。<p>然而，当我们尝试将这种思路应用到分布式系统中时，会面临两大难题：<ul><li>一大难题就在于怎么定义这个 " 相邻”。内存的相邻很好定义，就是物理地址相邻，但是对于数据库中的数据而言，情况会复杂得多，甚至同一张表中的数据，在不同的使用场景下，其相邻的定义可能也不尽相同；<li>另一个难题就是缓存加载的最小数据单位怎么确定？也就是类似 CPU 高速缓存的缓存行大小。这个值太小对空间局部性的利用程度有限，这个值太大会对缓存的加载开销和空间占用造成较大的压力。</ul><p>这两个问题没有一个通行的答案，而是需要根据自己的实际场景来权衡。下面，我将使用一个实际案例来为大家说明。<h2 id=实践案例><a class=header-anchor href=#实践案例>¶</a> 实践案例</h2><h3 id=背景与挑战><a class=header-anchor href=#背景与挑战>¶</a> 背景与挑战</h3><p>我所负责的一个面向消费者运营领域的无代码开发平台。其通过有向无环图来对消费者运营领域内的各种运营策略进行建模，来帮助运营直接实施各种体系化、精细化的运营措施。简称 “策略平台”。<p>策略平台除了利用有向无环图这一复杂模型以外，另一大特色便是其模型的有状态性。也就是说策略平台会记录每一个用户在每一个有向无环图的中所处的顶点等状态信息，这种有状态性进一步提升了模型的表达能力，因此能够支撑大量更加复杂的实际业务场景。<p>然而，天下没有免费的午餐，存储、写入、查询这些用户状态数据将会面临很多挑战，具体可分为以下几个方面：<ul><li>需要存储的数据量巨大，预估数据量级将达 10 亿以上，后续会随平台使用情况、业务量级等因素持续增长；<li>需要写入的数据量巨大，预计写入 TPS 将达 1 万以上，同样会随平台使用情况、业务量级等因素持续增长；<li>需要查询的数据量更大，预计查询 QPS 将达 10 万以上，同样会随平台使用情况、业务量级等因素持续增长。</ul><h3 id=应对措施><a class=header-anchor href=#应对措施>¶</a> 应对措施</h3><p>针对数据量大的问题<ul><li>在数据库选型阶段选择了 Lindorm（阿里云改良版 HBase）以支撑海量的数据。同时利用其表级、行级 TTL（Time To Live）机制，可以很方便的实现历史数据的自动清理；<li>同时，为了节省成本，选择了共享集群，其按照实际的存储、写入、查询用量来计费。但共享集群会存在 “吵闹邻居（Noisy neighbour）” 的问题，会面临一些偶发的抖动，因此需要做一些容错措施。</ul><p>针对写入数据量大的问题<ul><li>Lindorm（HBase）基于 LSM Tree 数据结构，其所有写入操作都是顺序写入，而无论是 SSD 还是 HDD，其顺序写入都是离散写入性能的数倍，因此可以提供显著的写入性能；<li>状态数据批量合并写入，对状态数据进行一定程度的合并处理再批量写入，以降低写入 TPS 并提升吞吐量；<li>状态数据裁剪，在写入前对状态数据进行过滤，仅保留有向无环图中被其他顶点依赖的顶点的状态数据，而非执行过程中涉及到的所有顶点的状态数据。经验证，此措施能大幅减少存储、写入、和查询的数据量；<li>另外，针对共享集群的偶发抖动，在数据库写入时采取了通过消息队列重试来进行容错，同时利用 Lindorm 所提供的时间戳多版本特性来解决重试导致的写入乱序而造成的数据不一致问题。</ul><p>毫无疑间，查询请求量大这个问题才是最大的挑战。并且仅依靠常见的缓存策略，即仅挖掘时间局部性，对于该问题的帮助不大，原因如下：<ul><li>在一次请求处理过程中，反复访问同一个顶点的状态数据的情况有，但很少，因此可以预期的此缓存的命中率不会高<li>在此基础上如果再引入多级缓存策略，无非就是将查询量级分摊一部分至 Redis 之类的存储，这将带来额外的成本、系统链路中的依赖增多导致进而导致 SLA 下降等问题</ul><p>因此，我不得不另辟蹊径，从另外两个思路出发：<ol><li>在数据写入时，我们可以采取批量合并的策略，将多次单条数据的写入请求合并为一次批量的写入请求来降低 TPS 提高吞吐量。那么在查询的时候，与之对应的策略是什么？<li>请求通常是用户维度的，一次请求进来通常涉及多个有向无环图的执行，同时每个有向无环图执行时又涉及多个顶点。这里存在明显的放大效应，即：状态数据库的查询量级 = 请求量级 x 平均每个请求涉及的有向无环图数量 × 平均每个有向无环图涉及的顶点数量。</ol><blockquote><p>思路 1 如果走偏了会变成：单条数据的查询请求来了先阻塞住，等攒到了一定的数量或者达到一定的时间了再用一个批量查询请求到数据库。这样的确能够做到批量合并，但毫无疑问会确定性的增加请求延迟，并且一次能攒多少不好说，也就是代价是一定会付出的，但是效果不一定有保障。另外，这种方式攒的请求通常都属于不同的用户，在数据库中的物理分布会相对离散，将这样的请求合并到一起做批量查询对数据库查询性能到底是有益还是有害还真不好说… 至少索引的开销应该是节省不了太多，相比于查询一批相邻的数据来说。</blockquote><p>最终，两个思路殊途同归，都指向一点：<strong>缓存的数据加载粒度 > 缓存的数据查询粒度</strong>。也就是我们前面所提到的 CPU 高速缓存中缓存行设计所体现的思路，以此来尝试挖掘状态数据查询请求的空间局部性。<p>由于 Lindorm 数据库中的状态表的主键（相当于 HBase 中的 Rowkey）的构成是：（用户 ID，有向无环图 ID，顶点 ID），即：（userld, graphld, vertexld）。同时 Lindrom 同 HBase 一样支持最左前缀匹配的范围查询。<p>要实现 “缓存的数据加载粒度> 缓存的数据查询粒度”，有两种选择：<ol><li>缓存加载粒度：（userld, graphld），即：查询某个用户在某个有向无环图中的某个顶点的状态数据，将会触发将这个用户在这个有向无环图中的所有顶点的状态数据都一并加载到缓存中；<li>缓存加载粒度：（userld），即：查询某个用户在某个有向无环图中的某个顶点的状态数据，将会触发将这个用户在所有有向无环图中的所有顶点的状态数据都一并加载到缓存中。</ol><p>当然，缓存的查询粒度取决于场景，必须保持完整的（userld, graphld, vertexId）不变。<p>几种缓存加载策略的对照如下：<table><thead><tr><th>缓存加载粒度<th>加载数据行数<th>加载数据量<th>加载延迟<th>空间局部性<th>存储压力<tbody><tr><td>（userld, graphld, vertexld）<td>一行<td>小<td>低<td>无<td>小<tr><td>（userld, graphld）<td>相邻多行<td>中<td>中<td>中<td>中<tr><td>（userld）<td>相邻多行<td>大<td>高<td>高<td>大</table><h3 id=初探空间局部性><a class=header-anchor href=#初探空间局部性>¶</a> 初探空间局部性</h3><p>由于在开发阶段就已经意识到用户状态的查询将会是系统中最大的性能热点，因此在平台上线之初就直接将此缓存的加载粒度配置到了（userld, graphld）的粒度，以此来挖掘一定程度的空间局部性，同时又避免带来过大的浪费和内存压力。当然，我们仍然可以通过监控缓存的原始查询量来估计以（userld, graphld, vertexld）为缓存加载粒度时甚至无缓存时数据库会面临的查询量级。<p>（userld, graphld）方案上线后，指标如下：<table><thead><tr><th>缓存加载粒度<th>缓存查询量级<th>缓存加载量级<th>单次缓存加载耗时<th>均摊缓存查询耗时 *<tbody><tr><td>（userld, graphld, vertexld）<td>6.8 万 / 秒<td>6.8 万 / 秒<td>1 毫秒 / 次<td>1 毫秒 / 次<tr><td>（userld, graphld）<td>6.8 万 / 秒<td>1.6 万 / 秒<td>1.5 毫秒 / 次<td>0.35 毫秒 / 次</table><p>均摊缓存查询耗时 *：指将总的缓存加载耗时均摊到总的缓存查询量级上。即：单次缓存加载耗时 x 缓存加载量级 ÷ 缓存查询量级<p>可以看到，通过挖掘空间局部性：<ul><li>缓存加载量级，即数据库的查询量级，下降到仅为原来的 23.5%；<li>但由于每次加载的数据量增多，单次加载耗时增加到原来的 150%，但绝对值仍然处于非常优秀的水平；<li>另外，如果我们将总的加载耗时均摊到总的查询量级上，即均摊分析。均摊查询耗时下降到仅为原来的 35%。也就是说，在查询用户状态数据这个场景上的整体开销下降了 65% 之多。</ul><h3 id=推向极限><a class=header-anchor href=#推向极限>¶</a> 推向极限</h3><p>（userld, graphld）方案上线后，经过一段时间的观察，我们发现内存压力和数据量级比预期中的小很多，完全处于可接受的水平。<p>因此，我们直接将这个方案推向极致 —— 缓存加载粒度来到（userId）！<table><thead><tr><th>缓存加载粒度<th>缓存查询量级<th>缓存加载量级<th>单次缓存加载耗时<th>均摊缓存查询耗时<tbody><tr><td>（userld, graphld, vertexld）<td>6.8 万 / 秒<td>6.8 万 / 秒<td>1 毫秒 / 次<td>1 毫秒 / 次<tr><td>（userld, graphld）<td>6.8 万 / 秒<td>1.6 万 / 秒<td>1.5 毫秒 / 次<td>0.35 毫秒 / 次<tr><td>（userld）<td>6.8 万 / 秒<td>0.28 万 / 秒<td>3.9 毫秒 / 次<td>0.16 毫秒 / 次</table><p>可以看到，将空间局部性的挖掘做到极致以后：<ul><li>缓存加载量级，即数据库的查询量级，下降到仅相当于查询量级 4.12% 的水平！<li>由于每次加载的数据量更多，单次加载耗时增加到接近原来的 4 倍，但绝对值仍然处于可接受的水平；<li>均摊查询耗时下降到仅为原来的 16%。也就是说，在查询用户状态数据这个场景上的整体开销下降了 84% 之多！</ul><h3 id=长期表现><a class=header-anchor href=#长期表现>¶</a> 长期表现</h3><p>平台经过较长时间的发展以后，状态缓存的查询量级又上了好几层楼，同时得益于在写入侧所做的数据裁剪等优化，最新的指标如下：<table><thead><tr><th>时间节点<th>缓存加载粒度<th>缓存查询量级<th>缓存加载量级<th>单次缓存加载耗时<th>均摊缓存查询耗时 *<tbody><tr><td>上线<td>（userld）<td>6.8 万 / 秒<td>0.28 万 / 秒<td>3.9 毫秒 / 次<td>0.16 毫秒 / 次<tr><td>现在<td>（userld）<td>71.7 万 / 秒<td>1.4 万 / 秒<td>1.17 毫秒 / 次<td>0.02 毫秒 / 次</table><p>通过最新的数据我们可以观察到：<ul><li>缓存加载量级，即数据库的查询量级，仅相当于查询量级的 1.95%！<li>此缓存的命中率稳定维持在 97.95% 左右；<li>单次缓存加载耗时降至 1.17 毫秒 / 次！此指标下降主要得益于写入侧的数据裁剪等优化，导致数据库整体的数据量级下降，因此这里需要加载的数据量也有较大的下降，从而加载耗时也大幅减小；<li>均摊查询耗时下降到惊人的 0.02 毫秒 / 次。也就是说，在查询用户状态数据这个场景上的整体开销下降了 98% 之多！</ul><p>在查询量级大幅上涨后，配合写入侧的优化措施，（userld）方案表现出了更大的潜力，而这都得益于其对空间局部性的充分挖掘。<h3 id=风险><a class=header-anchor href=#风险>¶</a> 风险</h3><p>看到这里，你肯定会担心，代价是什么？<ul><li>这么激进的缓存加载策略，会不会把内存打爆？<li>会不会存在某个用户 ID 下有海量的数据？<li>GC 压力如何？<li>内存要求会不会特别高？</ul><p>这些担忧都是非常有必要的，因此我们基于 Prometheus 自定义监控指标和内部的监控系统，对相关指标进行了详细且完备的监控：<ul><li>本地缓存使用数量、查询命中率、查询量级、加载量级、平均加载时长、加载失败率、驱逐量级等；<li>状态数据库表的批量写入大小和批量读取大小。用以监控单个用户名下数据量过大之类的风险；<li>单机的 JVM GC 表现，包括：每分钟 GC 频次、每分钟累计 GC 耗时、堆内存使用情况等。</ul><p>需要声明的是：<ul><li>状态缓存加载后仅 1 秒的有效期；<li>所有单机均为 4 核 CPU、8 GiB RAM 规格的 x86 容器。</ul><p>而通过上述的监控指标可以观察到：<ul><li>状态缓存的单机峰值利用率在 600 项左右，并不大，且距离 2048 的最大项数还有一定距离；<li>通过状态数据库表的批量查询监控观察到，批量查询的最大数据量在 12 条 / 批左右，且长期保持稳定，不存在任何尖刺。同时，从策略平台这个场景出发，也极不可能出现单用户名下数据量超多的情形；<li>单机的 GC 表现在 JDK 21 + G1 GC 的加持下，GC 频次在 2-5 次 / 分钟，GC 累计耗时在 40-130 毫秒 / 分钟（不是单次 GC 耗时），并且全是 Young GC；<li>单机 4 GiB 的堆内存，经过 Young GC 后能够下探到 1 GiB 以下的水位。</ul><p>即各项指标都处于非常健康的水平。<h3 id=回顾><a class=header-anchor href=#回顾>¶</a> 回顾</h3><p>前文曾提到，要将能够挖掘空间局部性的缓存策略，即：缓存的数据加载粒度 > 缓存的数据查询粒度，应用到分布式系统中时，会面临两大难题：<ol><li>如何定义 “相邻”？<li>如何确定缓存加载的数据粒度，即 “缓存行大小”？</ol><p>那么在上述的案例中，这两个难题是如何解决的？<ul><li>如何定义 “相邻”：在这个案例中，无论是按照（userld, graphld）还是（userld）的粒度来进行缓存加载，其都是符合数据库主键（Rowkey）的最左前缀匹配原则的。这意味着这些数据在实际存储时，在物理层面，也都是相邻的，这样在查询时能够很好的利用数据库乃至底层硬件的特性，减少索引开销，利用顺序读取等特性，从而优化批量查询时的性能开销，做到 1 + 1 < 2 的效果；<li>缓存加载的数据粒度：不同于 CPU 中的缓存行，其面临晶体管数量等严格的物理限制。在分布式系统中，我们面临的限制相比之下通常宽松得多，例如：内存大小。因此在这个案例中，我们得以以（userld, graphld）甚至（userld）这样的不定长粒度来作为缓存加载的数据粒度，从而将空间局部性挖掘到极致，这在 CPU 这类面临严苛物理限制的场景将是难以想象的。</ul><p>当然，这个案例本身具有一定的特殊性，状态数据的分布总体而言是相对稀疏的，尤其对于裁剪后的状态数据。在更加普遍的场景中，我们还是建议对缓存加载数据量设置一个硬限制，比如：批量加载时最多加载 N 行数据。这样虽然对于空间局部性的挖掘不能到达极限，但能够很好的控制内存压力，能够适用于更加广泛的场景，例如：单用户名下的数据就超过内存承受极限的场景。也更加类似于 CPU 中的缓存行的做法。<p>另外，在缓存加载时，对于数据库中不存在的值，一定要设置空对象来占位，以防止缓存穿透。并且这种防穿透的效果，也能随着缓存加载粒度的扩大而被增强。</div><footer class=post-footer><div class=post-copyright><ul><li class=post-copyright-author><strong>本文作者： </strong>回锅肉<li class=post-copyright-link><strong>本文链接：</strong> <a title="如何仅通过本地缓存就将数据库查询量级从 71.7 万 / 秒降至 1.4 万 / 秒" href=https://hyperscalar.pages.dev/zh/posts/Locality-of-Reference-and-Cache/>https://hyperscalar.pages.dev/zh/posts/Locality-of-Reference-and-Cache/</a><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a rel="noopener external nofollow noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</ul></div><div class=post-tags><a href=/zh/tags/%E6%80%A7%E8%83%BD%E5%B7%A5%E7%A8%8B/ rel=tag># 性能工程</a><a href=/zh/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/ rel=tag># 计算机体系结构</a><a href=/zh/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/ rel=tag># 分布式系统</a><a href=/zh/tags/%E5%AE%9E%E8%B7%B5%E7%BB%8F%E9%AA%8C/ rel=tag># 实践经验</a></div><div class=post-nav><div class=post-nav-item><a title="Paxos Made Simple 翻译及总结" href=/zh/posts/Paxos-Made-Simple-Reading/ rel=prev> <i class="fa fa-angle-left"></i> Paxos Made Simple 翻译及总结 </a></div><div class=post-nav-item></div></div></footer></article></div><div class="comments gitalk-container"></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>© 2018 – <span itemprop=copyrightYear>2024</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>回锅肉</span></div><div class=wordcount><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-chart-line"></i> </span> <span title=站点总字数>17k</span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-coffee"></i> </span> <span title=站点阅读时长>1:03</span> </span></div></div></footer><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div><div class=sidebar-dimmer></div><div class=reading-progress-bar></div><a class="book-mark-link book-mark-link-fixed" role=button></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><script alpha=1 size=128 src=https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js zindex=-1></script><script crossorigin integrity=sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY= src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script crossorigin integrity=sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao= src=https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js></script><script crossorigin integrity=sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc= src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js></script><script crossorigin integrity=sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc= src=https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js></script><script src=/zh/js/comments-fa9c2a33.js></script><script src=/zh/js/utils-942668d4.js></script><script src=/zh/js/motion-fd641dc3.js></script><script src=/zh/js/sidebar-e57927d8.js></script><script src=/zh/js/next-boot-9a3e5c9a.js></script><script src=/zh/js/bookmark-1fe573ae.js></script><script src=/zh/js/pjax-18169528.js></script><script crossorigin integrity=sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc= src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js></script><script src=/zh/js/third-party/search/local-search-db1b9a33.js></script><script class=next-config data-name=mermaid type=application/json>{"enable":true,"theme":{"light":"neutral","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script><script src=/zh/js/third-party/tags/mermaid-74adc08e.js></script><script class=next-config data-name=wavedrom type=application/json>{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/wavedrom.min.js","integrity":"sha256-INLAoJc6quTNfiMWkGZniYO2cxE8mHpddnLow1m6RFs="}}</script><script class=next-config data-name=wavedrom_skin type=application/json>{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/skins/default.js","integrity":"sha256-fduc/Zszk5ezWws2uInY/ALWVmIrmV6VTgXbsYSReFI="}}</script><script src=/zh/js/third-party/tags/wavedrom-a838adef.js></script><script crossorigin integrity=sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM= src=https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js></script><script class=next-config data-name=quicklink type=application/json>{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://hyperscalar.pages.dev/zh/posts/Locality-of-Reference-and-Cache/"}</script><script src=/zh/js/third-party/quicklink-1fae8327.js></script><link crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css integrity=sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U= rel=stylesheet><script class=next-config data-name=gitalk type=application/json>{"enable":true,"github_id":"hyperscalar","repo":"zh","client_id":"Ov23li5LC4fjn6mD8omR","client_secret":"4da5bc4d6ebae49e5fd9a9e39f0df9e7bd5b91b8","admin_user":"hyperscalar","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"7b1ec58907cd8d92136236c7345e8503"}</script><script src=/zh/js/third-party/comments/gitalk-93f59523.js></script>